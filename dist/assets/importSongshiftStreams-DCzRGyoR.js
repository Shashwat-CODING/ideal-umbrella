import{u as s,w as c,j as d,aj as m}from"./index-BIf49YX_.js";async function S(l){const n=JSON.parse(await l.text());if(!Array.isArray(n)){s("snackbar","Incompatible Database!");return}const a="https://api.piped.private.coffee",u=async(r,o="songshift",e=0)=>await fetch(`${a[e]}/search?q=${encodeURIComponent(r)}&filter=music_songs`).then(t=>t.json()).then(t=>{if("items"in t&&t.items.length>0)return t.items[0];throw new Error("insufficient data")}).then(t=>({id:t.url.substring(9),title:t.title,author:t.uploaderName+" - Topic",duration:m(t.duration),authorId:t.uploaderUrl?.slice(9),src:o})).catch(t=>{if(e<a.length-1)return u(r,o,e+1);console.error(t),s("snackbar","Failed to import "+r)}),h=n.map(r=>u(`${r.track} ${r.artist}`,r.service));c("isLoading",!0),await Promise.all(h).then(r=>{const e=r.filter(Boolean).map(t=>({id:t?.id,title:t?.title,author:t?.author,duration:t?.duration,authorId:t?.authorId})).reduce((t,p)=>{const{src:i,...f}=p;return t[i]||(t[i]=[]),t[i].push(f),t},{});for(const t in e)d(t,e[t]);s("snackbar","The Songshift streams have been imported")}).finally(()=>{c("isLoading",!1)})}export{S as default};
