import{f as R,a as h,g as q,p as e,ai as w,t as p,e as L,u as M,q as A,ab as W,z as k,i as y,c as b,a3 as C,b as l,P as T,S as F,C as I,a5 as P,F as _,d as U}from"./index-BIf49YX_.js";var V=p("<option>Captions"),z=p("<div class=watcher><video controls></video><div><button>Close</button><select><option>Resolution"),D=p("<track>"),H=p("<option>");function O(){const[v,x]=R({video:[],subtitles:[]});let t,f;const E=h.watchMode||{worst:"144p",low:"240",medium:"360p",high:"720p",lossless:"1080p"}[h.quality];q(async()=>{if(!e.stream.id)return;e.audio.pause();const d=await navigator.mediaCapabilities.decodingInfo({type:"file",video:{contentType:'video/mp4; codecs="av01.0.00M.08"',bitrate:1e7,framerate:22,height:720,width:1280}}).then(r=>r.supported),a=e.data,c=a.videoStreams.filter(r=>r.codec?.includes("av01")).length===4?a.videoStreams.find(r=>r.codec?.includes("av01"))?.url:!1,u=a.videoStreams.find(r=>r.codec?.includes("vp9"))?.url;t.currentTime=e.audio.currentTime,x({video:a.videoStreams.filter(r=>{if(c&&d&&r.codec?.includes("av01")||!c&&r.codec?.includes("vp9")||!u&&r.codec?.includes("avc1"))return!0}).map(r=>[r.resolution||r.quality,r.url]),subtitles:a.subtitles}),t.src&&(t.src="",t.pause()),E&&(t.src=w(f.value,!0))});function S(){t.pause(),_("status",""),_("isWatching",!1)}return(()=>{var d=z(),a=d.firstChild,c=a.nextSibling,u=c.firstChild,r=u.nextSibling;r.firstChild,a.addEventListener("error",()=>{if(t.src.endsWith("&fallback"))return;const i=new URL(t.src).origin,{invidious:n,index:s}=L;if(s<n.length){const o=n[s];t.src=t.src.replace(i,o),e.audio.src=e.audio.src.replace(i,o),M("index",s+1)}}),a.addEventListener("ratechange",()=>{e.audio.playbackRate=t.playbackRate}),a.addEventListener("seeked",()=>{e.audio.currentTime=t.currentTime}),a.addEventListener("playing",()=>{e.audio.paused&&e.audio.play()}),a.addEventListener("loadstart",()=>{t.currentTime=e.audio.currentTime,t.play()}),a.addEventListener("timeupdate",()=>{const i=e.audio.currentTime-t.currentTime,s=t.playbackRate-i;if(s<0)return;const o=Math.round(s*100)/100;o!==e.audio.playbackRate&&(e.audio.playbackRate=o)}),a.addEventListener("waiting",()=>{e.audio.paused||e.audio.pause()}),a.addEventListener("ended",()=>{A.list.length||(S(),W())}),a.addEventListener("pause",()=>{e.isWatching&&e.audio.pause(),e.audio.currentTime=t.currentTime}),a.addEventListener("play",()=>{t.currentTime=e.audio.currentTime,e.audio.play()});var m=t;typeof m=="function"?k(m,a):t=a,y(a,b(F,{get when(){return v().subtitles.length},get children(){return[V(),b(C,{get each(){return v().subtitles},children:i=>(()=>{var n=D();return l(s=>{var o=L.invidious[0]+i.url,$=i.name||i.label;return o!==s.e&&T(n,"src",s.e=o),$!==s.t&&T(n,"srclang",s.t=$),s},{e:void 0,t:void 0}),n})()})]}})),u.$$click=S,r.addEventListener("change",i=>{t.src=w(i.target.value,!0),t.currentTime=e.audio.currentTime,h.watchMode&&I("watchMode",i.target.selectedOptions[0].textContent)});var g=f;return typeof g=="function"?k(g,r):f=r,y(r,b(C,{get each(){return v().video},children:i=>(()=>{var n=H();return y(n,()=>i[0]),l(()=>n.selected=i[0]===E),l(()=>n.value=i[1]),n})()}),null),l(()=>T(a,"poster",P(e.stream.id,"mq"))),d})()}U(["click"]);export{O as default};
