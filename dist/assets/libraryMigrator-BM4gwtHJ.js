import{J as k,aj as a,a6 as c,K as u,L as v,u as g}from"./index-BIf49YX_.js";import{g as m,u as b}from"./hub-Co9BINa5.js";function $(){console.log("Old V1 library found. Starting migration...");const s={collections:0,tracks:0,discover:0,lists:0,skipped:0};try{const l=JSON.parse(localStorage.getItem("library")),d=k();for(const o in l)if(l.hasOwnProperty(o)){const n=l[o];if(o==="discover"){const r=m();r.discovery||(r.discovery=[]);for(const t in n){const{title:e,duration:i,channelUrl:p,author:h,frequency:y}=n[t];if(t.length!==11){console.warn(`Skipping invalid ID in V1 discover collection: ${t}`),s.skipped++;continue}r.discovery.push({id:t,author:h,title:e,duration:typeof i=="number"?a(i):i,frequency:y,authorId:p.slice(9)}),s.discover++}b(r),console.log("Migrated discover collection to hub.")}else if(o==="channels"||o==="playlists"){const r=Object.values(n).filter(t=>{let e=!1;return o==="playlists"?e=t.id.startsWith("PL")&&t.id.length===34||t.id.startsWith("OLAK5uy_")&&t.id.length===41:o==="channels"&&(e=t.id.startsWith("UC")&&t.id.length===24&&!t.name.startsWith("Artist")),e||(console.warn(`Skipping invalid item in V1 ${o} collection:`,t),s.skipped++),e});localStorage.setItem(`library_${o}`,JSON.stringify(r)),c(o),n&&(s.lists+=Object.keys(n).length),console.log(`Migrated list type: ${o}`)}else if(o==="favorites"){const r=[],t=[];for(const e in n){const i=n[e];if(i&&typeof i.id=="string"&&typeof i.title=="string"&&i.id.length===11){const p={id:i.id,title:i.title,author:i.author||"Unknown",duration:typeof i.duration=="number"?a(i.duration):i.duration.includes(":")?i.duration||"NULL":a(parseInt(i.duration)),authorId:i.channelUrl?.slice(9)||""};i.author&&i.author.includes(" - Topic")?r.push(e):t.push(e),d[e]=p}else console.warn(`Skipping invalid CollectionItem in V1 collection '${o}' with ID '${e}':`,i),s.skipped++}r.reverse(),t.reverse(),u("favorites",r),c("favorites"),u("liked",t),c("liked"),s.collections+=2,s.tracks+=r.length+t.length,console.log("Migrated collection: favorites and liked")}else{const r=[];for(const t in n){const e=n[t];if(e&&typeof e.id=="string"&&typeof e.title=="string"&&e.id.length===11){const i={id:e.id,title:e.title,author:e.author||"Unknown",duration:typeof e.duration=="number"?a(e.duration):e.duration.includes(":")?e.duration||"NULL":a(parseInt(e.duration)),authorId:e.channelUrl?.slice(9)||""};r.push(t),d[t]=i}else console.warn(`Skipping invalid CollectionItem in V1 collection '${o}' with ID '${t}':`,e),s.skipped++}o==="history"&&r.reverse(),u(o,r),c(o),s.collections++,s.tracks+=r.length,console.log(`Migrated collection: ${o}`)}}v(d),localStorage.removeItem("library");const f=`Migration Report:
- Collections: ${s.collections}
- Tracks: ${s.tracks}
- Discovery items: ${s.discover}
- Playlists/Channels: ${s.lists}
- Skipped items: ${s.skipped}

Library migration successful. Reload to apply changes?`;confirm(f)?location.reload():g("snackbar","Library migrated. Please reload."),console.log("Library migration complete.")}catch(l){console.error("Error during library migration:",l),g("snackbar","Error migrating library. Please clear app data.")}}export{$ as default};
